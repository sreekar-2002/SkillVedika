{% extends 'base.html' %}
{% block content %}

<div class="container mt-5 cart-container">
    <h2 class="mb-4 fw-bold">
        <i class="bi bi-bag-check text-success"></i> Your Cart 
        <span class="badge bg-success ms-2">{{ cart_items|length }}</span>
    </h2>



    {% if messages %}
        {% for message in messages %}
          <div class="alert alert-warning text-center" role="alert">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}


    {% if cart_items %}
        
        {% for item in cart_items %}
        <div class="cart-card shadow-sm">
            <div class="row g-0 align-items-center">

                <!-- IMAGE -->
                <div class="col-md-3 col-4">
                    <img src="{{ item.item_image }}" class="cart-img">
                </div>

                <!-- DETAILS GRID -->
                <div class="col-md-9 col-8">
                    <div class="details-grid">

                        <!-- NAME & PRICE -->
                        <div class="info-block">
                            <h5 class="fw-bold mb-1">{{ item.item_name }}</h5>
                            <p class="text-success fw-bold fs-6 mb-0">
                                ₹{{ item.item_price }}
                            </p>
                        </div>

                        <!-- QUANTITY WITH + / - -->
                        <div class="qty-block text-center">

                            <a href="{% url 'cart:update_quantity' item.id 'decrease' %}" 
                               class="qty-btn btn btn-outline-danger btn-sm">−</a>

                            <span class="fw-bold fs-6 mx-2">{{ item.quantity }}</span>

                            <a href="{% url 'cart:update_quantity' item.id 'increase' %}" 
                               class="qty-btn btn btn-outline-success btn-sm">+</a>

                            <!-- REMOVE BUTTON -->
                            <br>
                            <a href="{% url 'cart:update_quantity' item.id 'remove' %}" 
                               class="btn btn-sm btn-danger mt-2 remove-btn">
                                Remove
                            </a>
                        </div>

                        <!-- SUBTOTAL -->
                        <div class="subtotal-block text-end">
                            <h5 class="text-primary fw-bold mb-0">₹{{ item.subtotal }}</h5>
                        </div>

                    </div>
                </div>

            </div>
        </div>
        {% endfor %}

        <!-- TOTAL BILL -->
        <div class="total-box shadow-lg">
            <h3 class="fw-bold mb-3">Total: ₹{{ total_price }}</h3>
            <a href="{% url 'payment' %}" class="btn btn-success btn-lg px-5 mb-2">Proceed to Checkout</a>
            <br>
            <a href="{% url 'cart:clear_cart' %}" class="btn btn-outline-danger btn-lg">Clear Cart</a>
        </div>

    {% else %}
        <div class="empty-cart text-center">
            <img src="https://cdn-icons-png.flaticon.com/512/2038/2038854.png"
                 width="150" class="empty-img">
            <h3 class="fw-bold mt-3">Your cart is empty</h3>
            <p class="text-muted">Add delicious items to your cart and enjoy!</p>
            <a href="{% url 'showFood' %}" class="btn btn-primary btn-lg mt-3">
                Continue Shopping
            </a>
        </div>
    {% endif %}
</div>

<style>

/* Card style */
.cart-card {
    border-radius: 14px;
    padding: 14px;
    margin-bottom: 18px;
    background: rgba(255, 255, 255, 0.68);
    backdrop-filter: blur(10px);
    transition: 0.2s ease;
    animation: fadeIn 0.7s ease;
}
.cart-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
}

/* Product image */
.cart-img {
    height: 160px;
    width: 100%;
    object-fit: cover;
    border-radius: 12px;
}

/* UNIFORM GRID — FIXED 3 COLUMNS */
.details-grid {
    display: grid;
    grid-template-columns: 1fr 150px 120px;
    align-items: center;
    gap: 10px;
    height: 100%;
}

/* Quantity button style */
.qty-btn {
    width: 32px;
    height: 32px;
    padding: 0;
    font-size: 18px;
    border-radius: 8px;
}

.remove-btn {
    font-size: 0.8rem;
}

/* Alignments */
.info-block h5 {
    font-size: 1.1rem;
}
.subtotal-block h5 {
    font-size: 1.1rem;
}

/* Fade animation */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Total box */
.total-box {
    margin-top: 35px;
    padding: 25px;
    background: linear-gradient(135deg, #ffffff 25%, #def9ef);
    border-radius: 16px;
    text-align: right;
    animation: fadeIn 1s ease;
}

/* Empty cart */
.empty-cart {
    padding: 50px;
    animation: fadeIn 0.7s ease;
}
.empty-img:hover {
    transform: scale(1.1);
}

/* Responsive Fixes */
@media (max-width: 768px) {
    .details-grid {
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto auto;
        text-align: left;
    }
    .qty-block { 
        text-align: left;
        margin-top: 10px;
    }
    .subtotal-block {
        text-align: right !important;
    }
}

</style>

{% endblock %}
